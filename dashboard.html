<!DOCTYPE html>
<html lang="pt-PT">
<head>
<meta charset="UTF-8">
<title>Hayes Auto - Dashboard</title>
<style>
body{ margin:0; font-family:Arial; background:#111; color:white;}
nav{ background:#000; padding:18px; display:flex; justify-content:center; gap:50px;}
nav a{ color:white; text-decoration:none; font-weight:bold; cursor:pointer;}
nav a:hover{ color:#2563eb;}
.tab{ display:none; padding:40px; text-align:center;}
.tab.active{ display:block;}
.logout{ position:absolute; top:15px; right:20px; background:#2563eb; padding:8px 15px; border-radius:6px; cursor:pointer;}
input, select{ padding:8px; margin:8px 0; border-radius:6px;}
button{ padding:8px 12px; border:none; border-radius:6px; background:#2563eb; color:white; cursor:pointer; margin-top:10px;}
</style>
</head>
<body>

<div class="logout" onclick="logout()">Sair</div>

<nav>
  <a onclick="showTab('inicio')">InÃ­cio</a>
  <a onclick="showTab('servicos')">ServiÃ§os</a>
  <a onclick="showTab('stock')">Stock</a>
  <a id="bossTab" onclick="showTab('boss')">Boss</a>
</nav>

<div id="inicio" class="tab active">
  <h1>Bem-vindo Ã  Hayes Auto ðŸš—</h1>
</div>
<div id="servicos" class="tab">
  <h1>ServiÃ§os</h1>
</div>
<div id="stock" class="tab">
  <h1>Stock</h1>
</div>
<div id="boss" class="tab">
  <h1>Painel do Boss ðŸ‘‘</h1>

  <h3>Criar Novo Utilizador</h3>
  <input id="newUser" placeholder="Nome do utilizador">
  <input id="newPass" placeholder="Senha">
  <select id="newRole">
    <option value="staff">MecÃ¢nico</option>
    <option value="admin">PatrÃ£o</option>
  </select>
  <button onclick="createUser()">Criar Conta</button>

  <h3 style="margin-top:20px;">Utilizadores Existentes</h3>
  <div id="userList"></div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
import { getAuth, createUserWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-auth.js";
import { getFirestore, doc, setDoc, getDocs, collection } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyAOOQ4B0raow-AZ73zWqm9EWtowGNvhFCQ",
  authDomain: "hayes-auto.firebaseapp.com",
  projectId: "hayes-auto",
  storageBucket: "hayes-auto.appspot.com",
  messagingSenderId: "630755395669",
  appId: "1:630755395669:web:087effd137517dd04e2cdc",
  measurementId: "G-5WX19ZBVZG"
};
const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

// ProteÃ§Ã£o
if(!localStorage.getItem("user")) window.location.href="index.html";
if(localStorage.getItem("role") !== "admin") document.getElementById("bossTab").style.display="none";

// Abas
function showTab(tabId){
    document.querySelectorAll(".tab").forEach(t=>t.classList.remove("active"));
    document.getElementById(tabId).classList.add("active");
}

// Logout
function logout(){
    localStorage.removeItem("user");
    localStorage.removeItem("role");
    signOut(auth);
    window.location.href="index.html";
}

// Criar utilizador
window.createUser = async function(){
    const user = document.getElementById("newUser").value.trim();
    const pass = document.getElementById("newPass").value.trim();
    const role = document.getElementById("newRole").value;
    if(!user || !pass){ alert("Preenche todos os campos âŒ"); return; }

    try{
        const cred = await createUserWithEmailAndPassword(auth, user+"@hayesauto.com", pass);
        await setDoc(doc(db,"users",cred.user.uid),{username:user, role:role});
        document.getElementById("newUser").value="";
        document.getElementById("newPass").value="";
        renderUsers();
        alert("Conta criada âœ…");
    } catch(err){
        alert("Erro: " + err.message);
    }
}

// Mostrar utilizadores
window.renderUsers = async function(){
    const container = document.getElementById("userList");
    container.innerHTML="";
    const snapshot = await getDocs(collection(db,"users"));
    snapshot.forEach(docu=>{
        const u = docu.data();
        container.innerHTML += `<div style="margin:5px 0; background:#222; padding:10px; border-radius:6px;">${u.username} (${u.role})</div>`;
    });
}
renderUsers();

</script>
</body>
</html>
